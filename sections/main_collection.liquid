
<!-- 🔍 Filtros Avanzados -->
<div class="advanced-filters">
    <h3 class="filter-title">Filtrar por</h3>
    <form id="advanced-filter-form">
        <div class="filter-group">
            <h4>Marca</h4>
            <select id="filter-brand">
                <option value="">Todas</option>
                {% for product in collections.all.products %}
                    <option value="{{ product.vendor }}">{{ product.vendor }}</option>
                {% endfor %}
            </select>
        </div>

        <div class="filter-group">
            <h4>Calidad</h4>
            <select id="filter-quality">
                <option value="">Todas</option>
                {% for product in collections.all.products %}
                    {% for tag in product.tags %}
                        {% if tag contains 'Calidad_' %}
                            <option value="{{ tag | remove: 'Calidad_' }}">{{ tag | remove: 'Calidad_' }}</option>
                        {% endif %}
                    {% endfor %}
                {% endfor %}
            </select>
        </div>

        <div class="filter-group">
            <h4>Precio</h4>
            <input type="number" id="price-min" placeholder="Desde..." />
            <input type="number" id="price-max" placeholder="Hasta..." />
        </div>

        <div class="filter-group">
            <label><input type="checkbox" id="filter-availability" /> Solo disponibles</label>
        </div>

        <button type="submit" class="filter-apply-btn">Aplicar filtros</button>
    </form>
</div>

<!-- 🛍️ Listado de Productos -->
<div class="products-grid" id="product-list">
    {% for product in collections.all.products %}
        <div class="product-item" 
             data-brand="{{ product.vendor }}" 
             data-tags="{{ product.tags | join: ',' }}" 
             data-price="{{ product.price | money_without_currency }}" 
             data-available="{{ product.available }}">
            <a href="{{ product.url }}">
                <img src="{{ product.featured_image | image_url: width: 400 }}" alt="{{ product.title }}" class="product-image" />
                <h3 class="product-title">{{ product.title }}</h3>
                <p class="product-price">{{ product.price | money }}</p>
            </a>
        </div>
    {% endfor %}
</div>

<script>
    const form = document.getElementById('advanced-filter-form');
    const products = document.querySelectorAll('.product-item');

    form.addEventListener('submit', function(e) {
        e.preventDefault();

        const brand = document.getElementById('filter-brand').value.toLowerCase();
        const quality = document.getElementById('filter-quality').value.toLowerCase();
        const priceMin = parseFloat(document.getElementById('price-min').value) || 0;
        const priceMax = parseFloat(document.getElementById('price-max').value) || Infinity;
        const availability = document.getElementById('filter-availability').checked;

        products.forEach((product) => {
            const productBrand = product.getAttribute('data-brand').toLowerCase();
            const productTags = product.getAttribute('data-tags').toLowerCase();
            const productPrice = parseFloat(product.getAttribute('data-price').replace(',', '')) || 0;
            const productAvailable = product.getAttribute('data-available') === 'true';

            let isVisible = true;

            if (brand && productBrand !== brand) isVisible = false;
            if (quality && !productTags.includes('calidad_' + quality)) isVisible = false;
            if (productPrice < priceMin || productPrice > priceMax) isVisible = false;
            if (availability && !productAvailable) isVisible = false;

            product.style.display = isVisible ? 'block' : 'none';
        });
    });
</script>
